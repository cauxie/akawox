{% load dict_extras %}

{% load static %}


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen p-4 space-y-6">

  <!-- Topbar with Back Button and Title -->
  <div class="flex items-center mb-6">
    <a href="javascript:history.back()" class="text-white text-2xl mr-4">←</a>
    <h1 class="text-xl font-bold">Your Wallet</h1>
  </div>

  <!-- Account Info -->
  <section class="space-y-4">
    <div class="bg-zinc-900 p-4 rounded-xl shadow">
      <h2 class="text-base font-semibold text-purple-400">Akawo Contribution Account</h2>
      <p class="text-sm text-gray-400 mt-1">Group Virtual Account: {{ group.paystack_virtual_account }}</p>
      <p class="text-gray-400 text-sm mt-3">Contributed this month</p>
      <div class="text-2xl font-bold text-white">₦{{ group_member.total_contributed|floatformat:2 }}</div>
      <div class="mt-4 flex flex-col gap-3">
        <a href="{% url 'start_contribution_payment' %}" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-center">Contribute</a>
        <button class="text-gray-400 border border-green-600 text-green-500 px-4 py-2 rounded-lg cursor-not-allowed">Link accounts</button>
      </div>
    </div>

    <div class="bg-zinc-800 p-4 rounded-xl shadow">
      <h3 class="text-base font-semibold text-white">Contribution Withdrawal</h3>
      <p class="text-sm text-gray-400 mt-1">We help you remember about recurring payments for the fixed date.</p>
      <a class="mt-3 inline-block text-gray-400 cursor-not-allowed border border-green-600 px-4 py-1 rounded-lg" title="Withdrawal not available in test mode">Withdraw Contribution</a>
    </div>
  </section>

  <!-- Currency Cards -->
  <section class="grid grid-cols-2 gap-3">
    <div class="bg-zinc-800 p-3 rounded-xl shadow border-l-4 border-blue-500 flex items-center justify-between">
      <img src="{% static 'images/Flagusa.png' %}" alt="USD" class="h-5">
      <span class="font-semibold text-sm text-white">00.00 $</span>
    </div>
    <div class="bg-zinc-800 p-3 rounded-xl shadow border-l-4 border-yellow-500 flex items-center justify-between">
      <img src="{% static 'images/FlagGhana.png' %}" alt="GHS" class="h-5">
      <span class="font-semibold text-sm text-white">00.00 GHS</span>
    </div>
    <div class="bg-zinc-800 p-3 rounded-xl shadow border-l-4 border-green-600 flex items-center justify-between">
      <img src="{% static 'images/flagsa.jpeg' %}" alt="ZAR" class="h-5">
      <span class="font-semibold text-sm text-white">00.00 ZAR</span>
    </div>
    <div class="bg-zinc-800 p-3 rounded-xl shadow border-l-4 border-red-500 flex items-center justify-between">
      <img src="{% static 'images/flaguk.png' %}" alt="GBP" class="h-5">
      <span class="font-semibold text-sm text-white">00.00 GBP</span>
    </div>
  </section>

  <!-- Latest Transactions -->
  <section class="bg-zinc-900 p-4 rounded-xl shadow">
    <h3 class="text-base font-semibold mb-3 text-white">Latest Transactions</h3>
    <div class="space-y-3 text-sm">
      {% for tx in transactions %}
      <div class="flex justify-between border-b border-zinc-700 py-2">
        <div>
          <p class="font-semibold text-white">{{ tx.description }}</p>
          <p class="text-xs text-gray-500">{{ tx.date|date:"M d, Y H:i" }}</p>
        </div>
        <div class="text-right">
          <p class="font-bold {% if tx.amount > 0 %}text-green-400{% else %}text-red-400{% endif %}">₦{{ tx.amount|floatformat:2 }}</p>
          <p class="text-xs text-gray-400">{{ tx.get_transaction_type_display }}</p>
        </div>
      </div>
      {% empty %}
      <p class="text-gray-500 text-sm">No recent transactions.</p>
      {% endfor %}
    </div>
    <button class="mt-3 text-green-400 text-sm font-medium">See more</button>
  </section>

  <!-- All Expenses -->
  <section class="bg-zinc-900 p-4 rounded-xl shadow">
    <h3 class="text-base font-semibold mb-3 text-white">All Expenses</h3>
    <div class="flex justify-between text-xs text-gray-400">
      <div>Weekly: <span class="font-semibold text-white">00.00 $</span></div>
      <div>Monthly: <span class="font-semibold text-white">00.00 $</span></div>
    </div>
    <div class="mt-4 flex items-center justify-center">
      <div class="w-24 h-24 rounded-full border-[8px] border-red-500 flex items-center justify-center">
        <div class="text-center">
          <p class="text-xs text-gray-400">Contribution</p>
          <p class="font-bold text-md text-white">00.00 $</p>
        </div>
      </div>
    </div>
    <ul class="mt-4 text-sm space-y-2">
      <li class="flex items-center space-x-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> <span>Contribution</span></li>
      <li class="flex items-center space-x-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> <span>Withdrawal</span></li>
    </ul>
  </section>

  <!-- Payment History -->
  <section class="bg-zinc-900 p-4 rounded-xl shadow">
    <h2 class="text-base font-semibold mb-1 text-white">Payment History</h2>
    <p class="text-sm text-gray-400 mb-3">You have made <span class="font-bold text-green-400">95%</span> of payments on time.</p>

    <div class="overflow-x-auto">
      <table class="min-w-full text-sm text-center border-collapse text-white">
        <thead>
          <tr class="text-gray-400">
            <th class="text-left px-4 py-2">Year</th>
            {% for m in "JFMAMJJASOND" %}
            <th class="px-2">{{ m }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr class="border-t border-zinc-700">
            <td class="text-left px-4 py-2 font-medium">{{ year }}</td>
            {% for month in months %}
            {% with status=months|dict_get:month %}
            <td>
              {% if status == "on_time" %}
              <div class="w-4 h-4 rounded-full bg-green-500 mx-auto" title="On-time"></div>
              {% elif status == "missed" %}
              <div class="w-4 h-4 rounded-full bg-red-500 mx-auto" title="Missed"></div>
              {% elif status %}
              <div class="w-4 h-4 rounded-full bg-gray-500 mx-auto" title="{{ status }}"></div>
              {% else %}
              <div class="w-4 h-4 rounded-full bg-zinc-600 mx-auto" title="N/A"></div>
              {% endif %}
            </td>
            {% endwith %}
            {% endfor %}
          </tr>
        </tbody>
      </table>
    </div>
  </section>

</body>
</html>
